<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Partial torus mesh | Stride Community Toolkit Manual </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Partial torus mesh | Stride Community Toolkit Manual ">
      
      
      <link rel="icon" href="../../../favicon.ico">
      <link rel="stylesheet" href="../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../public/main.css">
      <meta name="docfx:navrel" content="../../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      <meta name="docfx:rel" content="../../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/stride3d/stride-community-toolkit/blob/main/docs/manual/code-only/examples/partial-torus-mesh.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../index.html">
            <img id="logo" class="svg" src="../../../media/stride-logo-blue-toolkit.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="partial-torus-mesh">Partial torus mesh</h1>

<p>This example demonstrates creating a 3D partial torus mesh programmatically by breaking down
the process into clear, distinct steps:</p>
<ol>
<li>Setting up a basic 3D scene with a skybox</li>
<li>Creating a parametrically defined torus geometry using mathematical formulas</li>
<li>Demonstrating how to generate a partial (incomplete) torus by constraining the bend angle</li>
<li>Building structured 3D mesh generation with proper vertex positioning and normal definitions</li>
</ol>
<p>The example showcases important 3D graphics concepts including:</p>
<ul>
<li>Parametric surface generation using two angle parameters (circumference and bend)</li>
<li>Correct normal calculation for accurate lighting and shading</li>
<li>Triangle winding order for proper face orientation</li>
<li>Vertex indexing to efficiently reuse vertices between adjacent triangles</li>
</ul>
<p><img src="media/stride-game-engine-example-05-partial-torus-mesh.webp" alt="Stride UI Example"></p>
<p>For more details of <code>MeshBuilder</code>, refer to our <a href="../../rendering/mesh-builder.html">MeshBuilder manual</a>.</p>
<div class="TIP">
<h5>Tip</h5>
<p>Notice the effect of back-face culling when moving the camera around the objects. With the default culling mode enabled, back faces are not rendered, optimizing performance by avoiding the drawing of surfaces that are not visible to the camera.</p>
<p>For open or partially open 3D models, viewing from inside or even from outside through an open area may cause the model to appear incomplete. This is normal behavior since back-face culling intentionally omits surfaces facing away from the camera.</p>
</div>
<div class="NOTE">
<h5>Note</h5>
<p>This example requires the additional NuGet packages <code>Stride.CommunityToolkit.Skyboxes</code> and <code>Stride.CommunityToolkit.Bepu</code>. Make sure to install <strong>both</strong> before running the code.</p>
</div>

<p>View on <a href="https://github.com/stride3d/stride-community-toolkit/tree/main/examples/code-only/Example05_PartialTorus">GitHub</a>.</p>
<pre><code class="lang-csharp">using Stride.CommunityToolkit.Bepu;
using Stride.CommunityToolkit.Engine;
using Stride.CommunityToolkit.Rendering.Utilities;
using Stride.CommunityToolkit.Skyboxes;
using Stride.Core.Mathematics;
using Stride.Engine;
using Stride.Graphics;
using Stride.Rendering;
using Stride.Rendering.Materials;
using Stride.Rendering.Materials.ComputeColors;

/*
  Procedural Partial Torus Mesh Generation

  This example demonstrates creating a 3D partial torus mesh programmatically by breaking down
  the process into clear, distinct steps:

  1. Setting up a basic 3D scene with a skybox
  2. Creating a parametrically defined torus geometry using mathematical formulas
  3. Demonstrating how to generate a partial (incomplete) torus by constraining the bend angle
  4. Building structured 3D mesh generation with proper vertex positioning and normal definitions

  The example showcases important 3D graphics concepts including:
  - Parametric surface generation using two angle parameters (circumference and bend)
  - Correct normal calculation for accurate lighting and shading
  - Triangle winding order for proper face orientation
  - Vertex indexing to efficiently reuse vertices between adjacent triangles

  The partial nature of the torus also highlights the effect of back-face culling. When viewing
  the open ends of the torus from certain angles, you can see through to the inside or outside,
  as surfaces facing away from the camera are not rendered. This is normal behavior and improves
  performance by avoiding the drawing of surfaces that wouldn't be visible in a complete object.
*/

// Torus parameters
const float CylinderRadius = 0.3f;
const float TorusAngle = 270.0f;
const float BendRadius = 1.0f;
const int CircumferenceStepsCount = 20;
const int BendSegmentSteps = 40;

using var game = new Game();

game.Run(start: (Scene rootScene) =&gt;
{
    game.SetupBase3DScene();
    game.AddSkybox();

    CreateMeshEntity(
        game.GraphicsDevice,
        rootScene,
        new Vector3(0.0f, 1.0f, 0.0f),
        b =&gt; BuildPartialTorusMesh(b, CylinderRadius, TorusAngle, BendRadius, CircumferenceStepsCount, BendSegmentSteps)
    );
});

Entity CreateMeshEntity(GraphicsDevice graphicsDevice, Scene scene, Vector3 position, Action&lt;MeshBuilder&gt; build)
{
    using var meshBuilder = new MeshBuilder();

    build(meshBuilder);

    var model = new Model
    {
        new MaterialInstance { Material = CreateMaterial(game) },
        new Mesh
        {
            Draw = meshBuilder.ToMeshDraw(graphicsDevice),
            MaterialIndex = 0
        }
    };

    var entity = new Entity { Scene = scene, Transform = { Position = position } };

    entity.Add(new ModelComponent { Model = model });

    return entity;
}

void BuildPartialTorusMesh(MeshBuilder meshBuilder, float cylinderRadius, float torusAngle, float bendRadius, int circumferenceStepsCount, int bendSegmentSteps)
{
    // for partial torus up to 360 degrees (torusAngle in degrees)
    meshBuilder.WithIndexType(IndexingType.Int16);
    meshBuilder.WithPrimitiveType(PrimitiveType.TriangleList);

    var position = meshBuilder.WithPosition&lt;Vector3&gt;();
    var normal = meshBuilder.WithNormal&lt;Vector3&gt;();

    // vertices
    for (int j = 0; j &lt;= bendSegmentSteps; j++)
    {
        // Torus angle position Phi starts at 0 in line with Z-axis and increases to Pi/2 at X-axis
        double tPhi = j * torusAngle / bendSegmentSteps * Math.PI / 180.0;
        double xc = bendRadius * Math.Sin(tPhi);
        double zc = bendRadius * Math.Cos(tPhi);

        for (int i = 0; i &lt; circumferenceStepsCount; i++)
        {
            // Circumference angle tTheta
            double tTheta = i * Math.Tau / circumferenceStepsCount;
            double yr = cylinderRadius * Math.Sin(tTheta);
            double xr = cylinderRadius * Math.Cos(tTheta) * Math.Sin(tPhi);
            double zr = cylinderRadius * Math.Cos(tTheta) * Math.Cos(tPhi);

            var tNorm = new Vector3((float)xr, (float)yr, (float)zr);
            var tPos = new Vector3((float)(xc + xr), (float)yr, (float)(zc + zr));

            meshBuilder.AddVertex();
            meshBuilder.SetElement(position, tPos);
            meshBuilder.SetElement(normal, tNorm);
        }
    }

    // Triangle indices
    for (int j = 0; j &lt; bendSegmentSteps; j++)
    {
        for (int i = 0; i &lt; circumferenceStepsCount; i++)
        {
            int i_tot = i + j * circumferenceStepsCount;
            int i_next = (i + 1) % circumferenceStepsCount + j * circumferenceStepsCount;

            // Triangle 1
            meshBuilder.AddIndex(i_tot);
            meshBuilder.AddIndex(i_next + circumferenceStepsCount);
            meshBuilder.AddIndex(i_tot + circumferenceStepsCount);

            // Triangle 2
            meshBuilder.AddIndex(i_tot);
            meshBuilder.AddIndex(i_next);
            meshBuilder.AddIndex(i_next + circumferenceStepsCount);
        }
    }
}

static Material CreateMaterial(Game game)
{
    return Material.New(game.GraphicsDevice, new MaterialDescriptor
    {
        Attributes = new MaterialAttributes
        {
            MicroSurface = new MaterialGlossinessMapFeature
            {
                GlossinessMap = new ComputeFloat(0.9f)
            },
            Diffuse = new MaterialDiffuseMapFeature
            {
                DiffuseMap = new ComputeColor(new Color4(1.0f, 0.3f, 0.5f, 1.0f))
            },
            DiffuseModel = new MaterialDiffuseLambertModelFeature(),
            Specular = new MaterialMetalnessMapFeature
            {
                MetalnessMap = new ComputeFloat(0.0f)
            },
            SpecularModel = new MaterialSpecularMicrofacetModelFeature
            {
                Environment = new MaterialSpecularMicrofacetEnvironmentGGXPolynomial()
            }
        }
    });
}
</code></pre>
</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/stride3d/stride-community-toolkit/blob/main/docs/manual/code-only/examples/partial-torus-mesh.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <div class="d-flex flex-column flex-sm-row justify-content-between pt-1 text-center small"><p>Supported by the <a href="https://dotnetfoundation.org/" target="_blank" rel="noopener">.NET Foundation</a></p><p>Made with <a href="https://dotnet.github.io/docfx">docfx</a></p><p>Stride Community Toolkit Website v.1.0.0.6</p><p>&copy; .NET Foundation and Contributors</p></div>
        </div>
      </div>
    </footer>
  </body>
</html>
